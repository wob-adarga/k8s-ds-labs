kind: SeldonDeployment
apiVersion: machinelearning.seldon.io/v1
metadata:
  name: sentence-extraction
  namespace: seldon
  labels: {}
spec:
  name: sentence-extraction
  protocol: seldon
  transport: grpc
  annotations: {}
  predictors:
    - name: default
      graph:
        name: sentence-extraction
        type: MODEL

      componentSpecs:
        - spec:
            containers:
              - name: sentence-extraction
                image: eu.gcr.io/adarga-docker/ds-knowledge-store-seldon:from_kustomize
                env:
                  - name: LOG_LEVEL
                    value: INFO
                  - name: MODEL_NAME
                    value: SentenceExtractor
                  - name: MODEL_DATA
                    value: /models/english.pickle

                volumeMounts:
                  - mountPath: /models
                    name: model-data

            initContainers:
              - name: nltk-initialiser
                image: eu.gcr.io/adarga-docker/toolbox/oras:0.10.0-b
                imagePullPolicy: IfNotPresent
                command:
                  - /bin/sh
                  - -xc
                  - |
                    export HOME=/tmp # to workaround privileged execution issues
                    oras-aws-ecr-login
                    echo "downloading Punkt"
                    cd /models
                    oras pull 382855879375.dkr.ecr.eu-west-2.amazonaws.com/nltk/punkt:latest --allow-all
                    echo "downloading vocab"
                    oras pull 382855879375.dkr.ecr.eu-west-2.amazonaws.com/nltk/english-vocab:latest --allow-all
                    echo "done"

                volumeMounts:
                  - mountPath: /models
                    name: model-data

                resources:
                  requests:
                    memory: 1Mi

            volumes:
              - emptyDir: {}
                name: model-data

      replicas: 1
